<!-- Institution Registration Form (Tailwind) -->
<section id="institution-registration" class="max-w-3xl mx-auto my-12 bg-white rounded-xl shadow p-6">
  <h3 class="text-2xl font-bold text-green-700 mb-4">üè´ Register Your Institution</h3>
  <p class="text-sm text-gray-600 mb-6">Quickly onboard your school, college, or NGO to join the Institution Collaboration Portal.</p>

  <form id="instRegForm" class="space-y-4" enctype="multipart/form-data" novalidate>
    <div class="grid md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Institution Name *</label>
        <input id="instName" name="name" required type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-green-500 focus:border-green-500" placeholder="Greenfield High School" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Type *</label>
        <select id="instType" name="type" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-green-500 focus:border-green-500">
          <option value="">Select type</option>
          <option value="School">School</option>
          <option value="College">College</option>
          <option value="NGO">NGO</option>
          <option value="Other">Other</option>
        </select>
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Address</label>
      <input id="instAddress" name="address" type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-green-500 focus:border-green-500" placeholder="City, State, Country" />
    </div>

    <div class="grid md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Contact Person *</label>
        <input id="contactPerson" name="contact_person" required type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-green-500 focus:border-green-500" placeholder="Jane Doe" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Email *</label>
        <input id="contactEmail" name="email" required type="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-green-500 focus:border-green-500" placeholder="contact@institution.org" />
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Phone</label>
        <input id="contactPhone" name="phone" type="tel" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-green-500 focus:border-green-500" placeholder="+91 98765 43210" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Website</label>
        <input id="instWebsite" name="website" type="url" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-green-500 focus:border-green-500" placeholder="https://example.org" />
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Focus Areas (select all that apply) *</label>
      <div class="mt-2 grid grid-cols-2 md:grid-cols-4 gap-2">
        <label class="inline-flex items-center space-x-2 text-sm">
          <input type="checkbox" name="focus" value="Tree Planting" class="form-checkbox h-4 w-4 text-green-600" />
          <span>Tree Planting</span>
        </label>
        <label class="inline-flex items-center space-x-2 text-sm">
          <input type="checkbox" name="focus" value="Waste Management" class="form-checkbox h-4 w-4 text-green-600" />
          <span>Waste Management</span>
        </label>
        <label class="inline-flex items-center space-x-2 text-sm">
          <input type="checkbox" name="focus" value="Energy Saving" class="form-checkbox h-4 w-4 text-green-600" />
          <span>Energy Saving</span>
        </label>
        <label class="inline-flex items-center space-x-2 text-sm">
          <input type="checkbox" name="focus" value="Awareness" class="form-checkbox h-4 w-4 text-green-600" />
          <span>Awareness</span>
        </label>
        <label class="inline-flex items-center space-x-2 text-sm">
          <input type="checkbox" name="focus" value="Biodiversity" class="form-checkbox h-4 w-4 text-green-600" />
          <span>Biodiversity</span>
        </label>
        <label class="inline-flex items-center space-x-2 text-sm">
          <input type="checkbox" name="focus" value="Water Conservation" class="form-checkbox h-4 w-4 text-green-600" />
          <span>Water Conservation</span>
        </label>
        <label class="inline-flex items-center space-x-2 text-sm">
          <input type="checkbox" name="focus" value="Other" class="form-checkbox h-4 w-4 text-green-600" />
          <span>Other</span>
        </label>
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Short Description</label>
      <textarea id="instDesc" name="description" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-green-500 focus:border-green-500" placeholder="A short sentence about your institution's sustainability goals..."></textarea>
    </div>

    <div class="grid md:grid-cols-2 gap-4 items-center">
      <div>
        <label class="block text-sm font-medium text-gray-700">Upload Logo (optional)</label>
        <input id="instLogo" name="logo" type="file" accept="image/*" class="mt-1 block w-full text-sm text-gray-600" />
      </div>

      <div class="text-sm text-gray-500">
        <p>Fields marked * are required.</p>
      </div>
    </div>

    <div class="pt-4 flex items-center space-x-3">
      <button id="submitInst" type="submit" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 shadow">Register Institution</button>
      <button id="resetInst" type="button" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">Reset</button>
      <span id="instFormMsg" class="text-sm text-gray-600 ml-3"></span>
    </div>
  </form>
</section>

<script>
  const API_URL = "http://127.0.0.1:5000"; // <-- keep or change to your production URL

  function getCheckedFocuses(form) {
    return Array.from(form.querySelectorAll('input[name="focus"]:checked')).map(cb => cb.value);
  }

  function showMessage(msg, isError = false) {
    const el = document.getElementById('instFormMsg');
    el.textContent = msg;
    el.classList.toggle('text-red-600', isError);
    el.classList.toggle('text-green-600', !isError);
  }

  document.getElementById('resetInst').addEventListener('click', () => {
    document.getElementById('instRegForm').reset();
    showMessage('');
  });

  document.getElementById('instRegForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const form = e.target;
    const name = document.getElementById('instName').value.trim();
    const type = document.getElementById('instType').value;
    const contactPerson = document.getElementById('contactPerson').value.trim();
    const email = document.getElementById('contactEmail').value.trim();

    // Basic client-side validation
    if (!name || !type || !contactPerson || !email) {
      showMessage('Please fill all required fields (marked *).', true);
      return;
    }

    const focuses = getCheckedFocuses(form);
    if (focuses.length === 0) {
      showMessage('Please select at least one focus area.', true);
      return;
    }

    // Build FormData to support file uploads
    const data = new FormData();
    data.append('name', name);
    data.append('type', type);
    data.append('address', document.getElementById('instAddress').value.trim());
    data.append('contact_person', contactPerson);
    data.append('email', email);
    data.append('phone', document.getElementById('contactPhone').value.trim());
    data.append('website', document.getElementById('instWebsite').value.trim());
    data.append('description', document.getElementById('instDesc').value.trim());
    data.append('focus', JSON.stringify(focuses)); // send array as JSON string

    const logoInput = document.getElementById('instLogo');
    if (logoInput.files && logoInput.files[0]) {
      data.append('logo', logoInput.files[0]);
    }

    showMessage('Registering institution...', false);
    document.getElementById('submitInst').disabled = true;

    try {
      const res = await fetch(`${API_URL}/register`, {
        method: 'POST',
        body: data
        // Note: don't set Content-Type when sending FormData; browser sets it.
      });

      if (!res.ok) {
        const text = await res.text().catch(() => null);
        throw new Error(text || `Server responded with ${res.status}`);
      }

      const payload = await res.json().catch(() => null);
      const message = (payload && payload.message) ? payload.message : 'Institution registered successfully!';
      showMessage(message, false);
      form.reset();
    } catch (err) {
      console.error(err);
      showMessage('Registration failed: ' + (err.message || 'Unknown error'), true);
    } finally {
      document.getElementById('submitInst').disabled = false;
    }
  });
</script>